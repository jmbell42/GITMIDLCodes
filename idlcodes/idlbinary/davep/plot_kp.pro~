filelist = file_search('*[^.]*')
if n_elements(date) eq 0 then date = ''
date = ask("date to plot (mmyyyy): ", date)

year = strmid(date,2,4)
month = strmid(date,0,2)

file = year

nlines = file_lines(file)
itime = intarr(6,nlines*8)
rtime = intarr(nlines*8)
kp = intarr(8,nlines*8)
temp = ''


openr,5,file
for iline = 0, nlines*8 - 1 do begin
    readf,5,temp
    for ichar = 0, 2 do begin
        itime(ichar,iline:iline+7) = fix(strmid(temp,ichar*2,2))
    endfor
   
    for i = iline, iline+7 do begin
        j = i - iline
        if j eq 0 then itime(3,i) = 0
        if j eq 1 then itime(3,i) = 3
        if j eq 2 then itime(3,i) = 6
        if j eq 3 then itime(3,i) = 9
        if j eq 4 then itime(3,i) = 12
        if j eq 5 then itime(3,i) = 15
        if j eq 6 then itime(3,i) = 18
        if j eq 7 then itime(3,i) = 21

        if j eq 0 then kp(j,i) = fix(strmid(temp,13,2))
        if j eq 1 then kp(j,i) = fix(strmid(temp,15,2))
        if j eq 2 then kp(j,i) = fix(strmid(temp,17,2))
        if j eq 3 then kp(j,i) = fix(strmid(temp,19,2))
        if j eq 4 then kp(j,i) = fix(strmid(temp,21,2))
        if j eq 5 then kp(j,i) = fix(strmid(temp,23,2))
        if j eq 6 then kp(j,i) = fix(strmid(temp,24,2))
        if j eq 7 then kp(j,i) = fix(strmid(temp,27,2))
        
        c_a_to_r,itime(*,i),rt
        rtime(i) = rt
    endfor
    
    
    iline = iline + 8
endfor

istart = min(where(itime(1,*) eq month))
iend = max(where(itime(1,*) eq month))


c_a_to_r,itime(*,istart),stime
c_a_to_r,itime(*,iend),etime

time_axis, stime, etime,btr,etr, xtickname, xtitle, xtickv, xminor, xtickn

plot, rtime(istart:iend), kp(istart:iend), ytitle = 'Kp',$
          xtickname = xtickname, xtickv = xtickv, $
          xminor = xminor, xticks = xtickn, xstyle = 1, $
          ystyle = 1, thick = 3, charsize = 1.2

end
