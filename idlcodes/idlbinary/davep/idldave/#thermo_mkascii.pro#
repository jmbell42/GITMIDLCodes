dt = 10  ;Minutes
outdt = 15
nIntervals = 24*60./dt 
nInts = 24*60./outdt

hour = 0


reread = 1
if reread then begin
attime = strarr(3,nIntervals)
asciitime = strarr(3,nInts)
atdata = fltarr(4,nIntervals)
asciidata = fltarr(4,nInts)


for iint = 0, nIntervals - 1 do begin

    mins = tostr(fix((iint*dt) mod 60.))
    if iint ne 0 and mins eq '0' then hour = hour + 1
    hour = chopr('0'+tostr(hour),2)
    mins = chopr('0'+tostr(mins),2)
    filelist = file_search('*t??????_'+hour+mins+'??*.bin')
    nfiles = n_elements(filelist)

    for ifile = 0, nfiles - 1 do begin
        fn = filelist(ifile)
        read_thermosphere_file, fn ,nvars, nalts, nlats, nlons, $
              vars, data, nBLKlat, nBLKlon, nBLK
    
        if ifile eq 0 then begin
            alldata = fltarr(nfiles,nvars)
            evar = where(vars eq '[e-]')
        endif

        alt = reform(data(2,0,0,2:nalts-3))/1000.0

        minalt = min(where(alt gt 200.0))
        ialth = min(where(alt ge 300.0))
        ialtl = ialth - 1
        
        ralt = (alt(ialth) - 300.0)/(alt(ialth) - alt(ialtl))
        
        nmf2 = max(data(evar,0,0,minalt+2:nalts-3),inmf2)
        inmf2 = inmf2 + minalt
        hmf2 = alt(inmf2)
        if inmf2 ge nalts - 7 then begin
            newalt = min(abs(alt-230),imin)
            nmf2 = data(evar,0,0,imin+2)
            hmf2 = 230.0
        endif

        alldata(ifile,0:1) = [nmf2,hmf2]
        for ivar = 0, nvars - 1 do begin
            alldata(ifile,ivar+2) = alldata(data(ivar+3,0,0,imin+2))
            
        endfor
    endfor

    attime(*,iint) = [hour,mins,'00']
    atdata(0,iint) =  mean(alldata(*,0))
    atdata(1,iint) =  stddev(alldata(*,0))
    atdata(2,iint) =  mean(alldata(*,1))
    atdata(3,iint) =  stddev(alldata(*,1))

  
endfor
endif

close,5
openw,5,'../gitmfile.txt'
printf,5,'GITM results file: Hour   Minute   Second   NmF2_mean  NmF2_stdev  HmF2_mean Hmf2_stdev'
smallint = 0 ;0 and nInts
for iint = 0, nIntervals - 1 do begin
    if attime(1,iint) eq '10' or attime(1,iint) eq '40' then begin
        
        asciitime(1,smallint) = tostr(fix(attime(1,iint) + 5))
        asciitime(0,smallint) = attime(0,iint) 
        asciitime(2,smallint) = attime(2,iint) 
        tfac = (20-15)/(20.-10)
        asciidata(*,smallint) = -tfac*(atdata(*,iint+1) - atdata(*,iint)) $
          + atdata(*,iint+1)

        iint = iint + 1
        printf, 5, format='(3(A7),4(G))', asciitime(*,smallint),asciidata(*,smallint)
    endif else begin
        asciidata(*,smallint) = atdata(*,iint)
        asciitime(*,smallint) = attime(*,iint)
        printf, 5, format='(3(A7),4(G))', asciitime(*,smallint),asciidata(*,smallint)
    endelse
    smallint = smallint + 1

endfor

    



close,5





;for ifile = 0, nfiles - 1 do begin
;    fn = filelist(ifile)
;    l = strpos(fn,'.bin')
;    fbase = strmid(fn,0,l-1)
;    afile = fbase+'.txt'
end

    
